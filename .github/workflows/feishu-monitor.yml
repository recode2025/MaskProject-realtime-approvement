name: Feishu Project Monitor

on:
  push:
    branches: [ "main", "master" ]
  issues:
    types: [opened, closed, reopened]

jobs:
  notify-workflow:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: read

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Run Build/Test Scripts
        if: github.event_name == 'push'
        run: |
          echo "æ‰§è¡Œæ„å»º/æµ‹è¯•ä»»åŠ¡..."
          sleep 2

      # - name: Notify Build Status
      #   # å³ä½¿å¤±è´¥ä¹Ÿå‘é€é€šçŸ¥
      #   if: always() && github.event_name == 'push'
      #   uses: foxundermoon/feishu-action@v2
      #   with:
      #     url: ${{ secrets.FEISHU_BOT_WEBHOOK_URL }}
      #     msg_type: post
      #     content: |
      #       post:
      #         zh_cn:
      #           title: "é¡¹ç›®æ„å»ºç»“æœ: ${{ job.status == 'success' && 'âœ… æˆåŠŸ' || 'âŒ å¤±è´¥' }}"
      #           content:
      #             - - tag: text
      #                 text: "ğŸ“¦ ä»“åº“: "
      #               - tag: text
      #                 text: "${{ github.repository }}"
      #             - - tag: text
      #                 text: "\nğŸ”¨ åˆ†æ”¯: "
      #               - tag: text
      #                 text: "${{ github.ref_name }}"
      #             - - tag: text
      #                 text: "\nğŸ‘¤ æäº¤äºº: "
      #               - tag: text
      #                 text: "${{ github.actor }}"
      #             - - tag: text
      #                 text: "\nğŸ“ æäº¤ä¿¡æ¯: "
      #               - tag: text
      #                 text: "${{ github.event.head_commit.message }}"
      #             - - tag: text
      #                 text: "\n--------------------------------"
      #             - - tag: a
      #                 text: "ğŸ” æŸ¥çœ‹å®Œæ•´æµæ°´çº¿è¯¦æƒ…"
      #                 # å…³é”®ä¿®å¤ç‚¹ï¼šè¿™é‡Œçš„åˆ†éš”ç¬¦å’Œæ‹¬å·ç°åœ¨æ˜¯æ­£ç¡®çš„äº†
      #                 href: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"

      - name: Notify Issue Update
        if: github.event_name == 'issues'
        uses: foxundermoon/feishu-action@v2
        with:
          url: ${{ secrets.FEISHU_BOT_WEBHOOK_URL }}
          msg_type: post
          content: |
            post:
              zh_cn:
                title: ğŸ§© Issue åŠ¨æ€æé†’
                content:
                  - - tag: text
                      text: "æ“ä½œ: "
                    - tag: text
                      text: "${{ github.event.action }}"
                  - - tag: text
                      text: "\nğŸ“Œ æ ‡é¢˜: "
                    - tag: text
                      text: "${{ github.event.issue.title }}"
                  - - tag: a
                      text: "\nğŸ‘‰ ç‚¹å‡»æŸ¥çœ‹ Issue"
                      href: "${{ github.event.issue.html_url }}"