name: Feishu Project Monitor

on:
  # 1. ç›‘å¬ä»£ç æäº¤ (æ„å»ºæé†’)
  push:
    branches: [ "main", "master" ]
  # 2. ç›‘å¬ Issue å˜åŠ¨ (Issue åŒæ­¥)
  issues:
    types: [opened, closed, reopened]

jobs:
  notify-workflow:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      # --- æ¨¡æ‹Ÿæ„å»º/æµ‹è¯•é˜¶æ®µ (ä»…åœ¨ Push æ—¶è¿è¡Œ) ---
      - name: Run Build/Test Scripts
        if: github.event_name == 'push'
        run: |
          echo "æ­£åœ¨æ‰§è¡Œæ„å»ºä»»åŠ¡..."
          # åœ¨è¿™é‡Œæ›¿æ¢æˆä½ çœŸå®çš„æ„å»ºå‘½ä»¤ï¼Œä¾‹å¦‚: npm install && npm test
          sleep 5 # æ¨¡æ‹Ÿè€—æ—¶
          echo "æ„å»ºå®Œæˆ"

      # --- åœºæ™¯ 1: ä»£ç æ„å»ºç»“æœé€šçŸ¥ ---
      # - name: Notify Build Status (Push)
      #   # if: always() ç¡®ä¿å³ä½¿æ„å»ºå¤±è´¥ä¹Ÿä¼šå‘é€é€šçŸ¥ï¼Œä¸”ä»…åœ¨ push äº‹ä»¶è§¦å‘
      #   if: always() && github.event_name == 'push'
      #   uses: foxundermoon/feishu-action@v2
      #   with:
      #     url: ${{ secrets.FEISHU_BOT_WEBHOOK_URL }}
      #     msg_type: post
      #     content: |
      #       post:
      #         zh_cn:
      #           title: ğŸš€ é¡¹ç›®æ„å»ºé€šçŸ¥ (${{ job.status }})
      #           content:
      #             - - tag: text
      #                 text: "ğŸ“¦ ä»“åº“: "
      #               - tag: text
      #                 text: "${{ github.repository }}"
      #             - - tag: text
      #                 text: "\nğŸ”¨ åˆ†æ”¯: "
      #               - tag: text
      #                 text: "${{ github.ref_name }}"
      #             - - tag: text
      #                 text: "\nğŸ‘¤ æäº¤äºº: "
      #               - tag: text
      #                 text: "${{ github.actor }}"
      #             - - tag: text
      #                 text: "\nğŸ“ æäº¤ä¿¡æ¯: "
      #               - tag: text
      #                 text: "${{ github.event.head_commit.message }}"
      #             - - tag: text
      #                 text: "\n"
      #             - - tag: a
      #                 text: "ğŸ‘‰ æŸ¥çœ‹æ„å»ºè¯¦æƒ…"
      #                 href: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"

      # --- åœºæ™¯ 2: Issue åŠ¨æ€é€šçŸ¥ ---
      - name: Notify Issue Update
        if: github.event_name == 'issues'
        uses: foxundermoon/feishu-action@v2
        with:
          url: ${{ secrets.FEISHU_BOT_WEBHOOK_URL }}
          msg_type: post
          content: |
            post:
              zh_cn:
                title: ğŸ§© Issue åŠ¨æ€æé†’
                content:
                  - - tag: text
                      text: "Action: "
                    - tag: text
                      text: "${{ github.event.action }}"
                  - - tag: text
                      text: "\nğŸ“Œ æ ‡é¢˜: "
                    - tag: text
                      text: "${{ github.event.issue.title }}"
                  - - tag: text
                      text: "\nğŸ‘¤ æ“ä½œäºº: "
                    - tag: text
                      text: "${{ github.actor }}"
                  - - tag: text
                      text: "\n"
                  - - tag: a
                      text: "ğŸ‘‰ ç‚¹å‡»æŸ¥çœ‹ Issue"
                      href: "${{ github.event.issue.html_url }}"